<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SG - Como Llego</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        height: 100vh;
        overflow: hidden;
      }
    </style>
  </head>
  <body class="flex flex-col items-center justify-center h-screen bg-gray-100">
    <div class="w-full max-w-xs mx-auto p-4">
      <div class="flex justify-center mb-6">
        <img
          src="https://i.imgur.com/PZrOpqH.png"
          alt="Pilar del Este Logo"
          class="h-256 w-auto"
        />
      </div>

      <input
        type="text"
        id="loteInput"
        class="w-full p-4 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="N¬∫ de LOTE"
        maxlength="4"
        required
      />

      <button
        onclick="handleSubmit()"
        class="mt-4 w-full py-3 bg-blue-500 text-white text-lg font-semibold rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        Ir
      </button>
    </div>

    <!-- Footer -->
    <footer class="mt-8 text-gray-500 text-sm">
      üë®‚Äçüíª Desarrollado por Cova - Miranda
    </footer>

    <script>
      const coordsUrl = "https://bucket.sg-comollego.ar/coords.json";
      const googleMapsUrlTemplate =
        "https://www.google.com/maps/dir/?api=1&destination=<destination>&travelmode=driving&dir_action=navigate";

      async function handleSubmit() {
        const loteInput = document.getElementById("loteInput");
        const unidadFuncional = loteInput.value;
        console.log(unidadFuncional);

        try {
          const response = await fetch(coordsUrl);
          const coords = await response.json();
          console.log(coords);
          const coord = coords.find((item) => item.lote === unidadFuncional);

          if (coord) {
            const destinationUrl = googleMapsUrlTemplate.replace(
              "<destination>",
              `${coord.coord.lat},${coord.coord.lng}`
            );
            window.location.href = destinationUrl;
          } else {
            alert("No se encontraron coordenadas para el lote ingresado");
          }
        } catch (error) {
          console.error("Error al cargar los datos:", error);
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        document.getElementById("loteInput").value = "";
      });

      // Swipe down to refresh feature
      let startY;

      window.addEventListener("touchstart", (event) => {
        startY = event.touches[0].clientY;
      });

      window.addEventListener("touchmove", (event) => {
        const endY = event.touches[0].clientY;
        const distance = endY - startY;

        // Check if swipe down is detected (distance threshold)
        if (distance > 50) {
          // Prevent accidental swipes triggering refresh
          location.reload();
        }
      });
    </script>
  </body>
</html>
